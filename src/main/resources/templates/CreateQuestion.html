<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ask a Public Question</title>

    <link rel="stylesheet" th:href="@{/css/createquestion.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">

    <!-- ⬇ extra layout tweaks -->
    <style>
        /* two-column grid (main + help) */
        .content-wrapper{
            flex:1;
            display:grid;
            grid-template-columns: 1fr 300px; /* main | help */
            gap:32px;
            padding:40px 64px;
            background:#f1f2f3;               /* grey strip like SO */
        }
        /* main column holds the old .container styles */
        .question-column{
            background:#fff;border-radius:8px;
            padding:30px 40px;box-shadow:0 2px 10px rgba(0,0,0,.05);
            display:flex;flex-direction:column;gap:24px;
        }
        /* right column background */
        .help-column{
            background:#f8f9f9;border:1px solid #e4e6e8;
            border-radius:6px;padding:24px;height:max-content;
        }
    </style>
</head>
<body>

<div th:replace="fragments/header :: header"></div>

<!-- ======= sidebar + main area ======= -->
<div class="layout">
    <div th:replace="fragments/Sidebar :: Sidebar"></div>

    <main class="content-wrapper">

        <!-- ========== MAIN QUESTION FORM ========== -->
        <section class="question-column">

            <h1>Ask a public question</h1>

            <form th:action="@{/review}" th:object="${question}" method="post">
                <!-- TITLE --------------------------------------------------- -->
                <div>
                    <label for="title">Title*</label>
                    <div class="subtext">Be specific and imagine you’re asking a question to another person</div>
                    <input id="title" type="text" th:field="*{title}"
                           placeholder="e.g. How do I find the index of an element in a list?"/>
                </div>

                <!-- DESCRIPTION -------------------------------------------- -->
                <div>
                    <label for="description">Description*</label>
                    <div class="subtext">Include all the information someone would need to answer your question</div>
                    <textarea id="description" th:field="*{description}"></textarea>
                    <div class="code-block-tip">
                        ```code``` &nbsp;&nbsp; **bold** &nbsp;&nbsp; *italic* &nbsp;&nbsp; &gt;quote
                    </div>
                </div>

                <!-- TAGS ----------------------------------------------------- -->
                <label for="tagInput">Tags*</label>
                <div class="subtext">Type to search or add (max&nbsp;5)</div>

                <div id="tagBox" class="tag-box">
                    <input id="tagInput" autocomplete="off" placeholder="start typing…">
                </div>

                <ul id="tagMenu" class="tag-menu hidden">
                    <li th:each="t : ${allTags}" th:text="${t}" class="item">java</li>
                </ul>

                <input type="hidden" id="tagsHidden" name="tags">
                <p th:field="${tags}"></p>

                <button class="ask-btn" type="submit">Review your question</button>
            </form>
        </section>

        <!-- ========== HELP SECTION ========== -->
        <aside class="help-column">
            <div class="help-box">
                <h2>Step&nbsp;1: Draft your question</h2>
                <p>The community is here to help you with specific coding, algorithm, or language problems.</p>
                <p><strong>Avoid asking opinion-based questions.</strong></p>

                <details class="help-step">
                    <summary>1. Summarize the problem</summary>
                    <div class="step-content">
                        Explain what you're trying to do and what you expected to happen.
                    </div>
                </details>

                <details class="help-step">
                    <summary>2. Describe what you’ve tried</summary>
                    <div class="step-content">
                        Share the research or steps you've taken so far.
                    </div>
                </details>

                <details class="help-step">
                    <summary>3. Show some code</summary>
                    <div class="step-content">
                        Add relevant code snippets to illustrate your issue.
                    </div>
                </details>
            </div>
        </aside>

    </main>
</div>

<!-- ========== TAG-PICKER JS (unchanged) ========== -->
<script th:inline="javascript">
    /*<![CDATA[*/
    (() => {
        const MAX = 5;

        const box   = document.getElementById('tagBox');
        const input = document.getElementById('tagInput');
        const menu  = document.getElementById('tagMenu');
        const items = Array.from(menu.querySelectorAll('.item'));
        const hidden= document.getElementById('tagsHidden');

        let selected = [];

        /* helpers */
        const syncHidden = () => hidden.value = selected.join(',');
        const addChip = tag => {
            const chip = document.createElement('span');
            chip.className = 'tag-chip';
            chip.textContent = tag;
            const x = document.createElement('span');
            x.className = 'x'; x.textContent = '×';
            x.onclick = () => remove(tag);
            chip.appendChild(x);
            box.insertBefore(chip, input);
        };
        const render = () => {
            box.querySelectorAll('.tag-chip').forEach(c => c.remove());
            selected.forEach(addChip);
            syncHidden();
        };
        const add    = t => { if(t && !selected.includes(t) && selected.length<MAX){ selected.push(t); render();} };
        const remove = t => { selected = selected.filter(s=>s!==t); render(); };

        /* filtering */
        const filter = q=>{
            let first=null;
            items.forEach(li=>{
                const show=li.textContent.includes(q)&&!selected.includes(li.textContent);
                li.style.display=show?'block':'none';
                li.classList.remove('active');
                if(show&&!first) first=li;
            });
            first?.classList.add('active');
            menu.classList.toggle('hidden',!q&&first==null);
        };

        /* events */
        input.addEventListener('input',e=>filter(input.value.toLowerCase()));
        input.addEventListener('keydown',e=>{
            if(e.key==='Enter'||e.key===','){e.preventDefault(); add(input.value.trim().toLowerCase()); input.value=''; filter('');}
            if(e.key==='ArrowDown') menu.querySelector('.active')?.focus();
        });
        items.forEach(li=>li.addEventListener('mousedown',()=>{add(li.textContent); input.value=''; filter('');}));
        document.addEventListener('click',e=>{ if(!box.contains(e.target)&&!menu.contains(e.target)) menu.classList.add('hidden'); });
    })();
    /*]]>*/
</script>
</body>
</html>
